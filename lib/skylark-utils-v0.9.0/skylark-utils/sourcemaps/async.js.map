{"version":3,"sources":["async.js"],"names":["define","skylark","langx","debounce","fn","wait","timeout","args","later","apply","arguments","clearTimeout","setTimeout","nextTick","requestAnimationFrame","this","async","Deferred","promise","Promise","resolve","reject","_resolve","_reject","bind","prototype","value","call","reason","then","callback","errback","progback","all","array","first","race","when","valueOrPromise","receivedPromise","nativePromise","length","deferred","cancel","progress","err","d","data","immediate","mixin"],"mappings":";;;;;;;AAAAA,QACI,YACA,WACD,SAASC,EAAQC,GAuEhB,QAASC,GAASC,EAAIC,GAClB,GAAIC,GACAC,EACAC,EAAQ,WACJJ,EAAGK,MAAM,KAAMF,GAGvB,OAAO,YACHA,EAAOG,UACPC,aAAaL,GACbA,EAAUM,WAAWJ,EAAOH,IAIpC,QAASQ,GAAST,GAEd,MADAU,uBAAsBV,GACfW,KAGX,QAASC,GAAMZ,GACX,MAAOY,GAzFX,GAAIC,GAAW,WACXF,KAAKG,QAAU,GAAIC,SAAQ,SAASC,EAASC,GACzCN,KAAKO,SAAWF,EAChBL,KAAKQ,QAAUF,GACjBG,KAAKT,OAEPA,KAAKK,QAAUH,EAASQ,UAAUL,QAAQI,KAAKT,MAC/CA,KAAKM,OAASJ,EAASQ,UAAUJ,OAAOG,KAAKT,MAgGjD,OA5FAE,GAASQ,UAAUL,QAAU,SAASM,GAElC,MADAX,MAAKO,SAASK,KAAKZ,KAAKG,QAASQ,GAC1BX,KAAKG,SAGhBD,EAASQ,UAAUJ,OAAS,SAASO,GAEjC,MADAb,MAAKQ,QAAQI,KAAKZ,KAAKG,QAASU,GACzBb,KAAKG,SAGhBD,EAASQ,UAAUI,KAAO,SAASC,EAAUC,EAASC,GAClD,MAAOjB,MAAKG,QAAQW,KAAKC,EAAUC,EAASC,IAGhDf,EAASgB,IAAM,SAASC,GACpB,MAAOf,SAAQc,IAAIC,IAGvBjB,EAASkB,MAAQ,SAASD,GACtB,MAAOf,SAAQiB,KAAKF,IAGxBjB,EAASoB,KAAO,SAASC,EAAgBR,EAAUC,EAASC,GACxD,GAAIO,GAAkBD,GAAiD,kBAAxBA,GAAeT,KAC1DW,EAAgBD,GAAmBD,YAA0BnB,QAEjE,KAAKoB,EACD,MAAI7B,WAAU+B,OAAS,EACZX,EAAWA,EAASQ,GAAkBA,GAEtC,GAAIrB,IAAWG,QAAQkB,EAE/B,KAAKE,EAAe,CACvB,GAAIE,GAAW,GAAIzB,GAASqB,EAAeK,OAC3CL,GAAeT,KAAKa,EAAStB,QAASsB,EAASrB,OAAQqB,EAASE,UAChEN,EAAiBI,EAASxB,QAG9B,MAAIY,IAAYC,GAAWC,EAChBM,EAAeT,KAAKC,EAAUC,EAASC,GAE3CM,GAGXrB,EAASI,OAAS,SAASwB,GACvB,GAAIC,GAAI,GAAI7B,EAEZ,OADA6B,GAAEzB,OAAOwB,GACFC,EAAE5B,SAGbD,EAASG,QAAU,SAAS2B,GACxB,GAAID,GAAI,GAAI7B,EAEZ,OADA6B,GAAE1B,QAAQ2B,GACHD,EAAE5B,SAGbD,EAAS+B,UAAY/B,EAASG,QAyB9BlB,EAAM+C,MAAMjC,GACRiB,IAAKhB,EAASgB,IACd9B,SAAUA,EACVc,SAAUA,EACVkB,MAAQlB,EAASkB,MACjBtB,SAAWA,EACXQ,OAASJ,EAASI,OAClBD,QAAUH,EAASG,QACnBiB,KAAMpB,EAASoB,OAGZpC,EAAQe,MAAQA","file":"../async.js","sourcesContent":["define([\r\n    \"./skylark\",\r\n    \"./langx\"\r\n], function(skylark,langx) {\r\n\r\n    var Deferred = function() {\r\n        this.promise = new Promise(function(resolve, reject) {\r\n            this._resolve = resolve;\r\n            this._reject = reject;\r\n        }.bind(this));\r\n\r\n        this.resolve = Deferred.prototype.resolve.bind(this);\r\n        this.reject = Deferred.prototype.reject.bind(this);\r\n\r\n    };\r\n\r\n    Deferred.prototype.resolve = function(value) {\r\n        this._resolve.call(this.promise, value);\r\n        return this.promise;\r\n    };\r\n\r\n    Deferred.prototype.reject = function(reason) {\r\n        this._reject.call(this.promise, reason);\r\n        return this.promise;\r\n    };\r\n\r\n    Deferred.prototype.then = function(callback, errback, progback) {\r\n        return this.promise.then(callback, errback, progback);\r\n    };\r\n\r\n    Deferred.all = function(array) {\r\n        return Promise.all(array);\r\n    };\r\n\r\n    Deferred.first = function(array) {\r\n        return Promise.race(array);\r\n    };\r\n\r\n    Deferred.when = function(valueOrPromise, callback, errback, progback) {\r\n        var receivedPromise = valueOrPromise && typeof valueOrPromise.then === \"function\";\r\n        var nativePromise = receivedPromise && valueOrPromise instanceof Promise;\r\n\r\n        if (!receivedPromise) {\r\n            if (arguments.length > 1) {\r\n                return callback ? callback(valueOrPromise) : valueOrPromise;\r\n            } else {\r\n                return new Deferred().resolve(valueOrPromise);\r\n            }\r\n        } else if (!nativePromise) {\r\n            var deferred = new Deferred(valueOrPromise.cancel);\r\n            valueOrPromise.then(deferred.resolve, deferred.reject, deferred.progress);\r\n            valueOrPromise = deferred.promise;\r\n        }\r\n\r\n        if (callback || errback || progback) {\r\n            return valueOrPromise.then(callback, errback, progback);\r\n        }\r\n        return valueOrPromise;\r\n    };\r\n\r\n    Deferred.reject = function(err) {\r\n        var d = new Deferred();\r\n        d.reject(err);\r\n        return d.promise;\r\n    };\r\n\r\n    Deferred.resolve = function(data) {\r\n        var d = new Deferred();\r\n        d.resolve(data);\r\n        return d.promise;\r\n    };\r\n\r\n    Deferred.immediate = Deferred.resolve;\r\n\r\n    function debounce(fn, wait) {\r\n        var timeout,\r\n            args,\r\n            later = function() {\r\n                fn.apply(null, args);\r\n            };\r\n\r\n        return function() {\r\n            args = arguments;\r\n            clearTimeout(timeout);\r\n            timeout = setTimeout(later, wait);\r\n        };\r\n    }\r\n\r\n    function nextTick(fn) {\r\n        requestAnimationFrame(fn);\r\n        return this;\r\n    }\r\n\r\n    function async(fn) {\r\n        return async;\r\n    }\r\n\r\n    langx.mixin(async, {\r\n        all: Deferred.all,\r\n        debounce: debounce,\r\n        Deferred: Deferred,\r\n        first : Deferred.first,\r\n        nextTick : nextTick,\r\n        reject : Deferred.reject,\r\n        resolve : Deferred.resolve,\r\n        when: Deferred.when\r\n    });\r\n\r\n    return skylark.async = async;\r\n});\r\n"]}